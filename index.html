<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Dice Pool Roller</title>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --container-bg: white;
            --pool-bg: #f8f9fa;
            --history-border: #eee;
            --button-bg: #2ecc71;
            --button-hover: #27ae60;
            --button-clear: #e74c3c;
            --button-clear-hover: #c0392b;
            --dice-bg: #3498db;
            --dice-text: white;
            --tab-inactive: #ddd;
        }

        
        .dark-theme {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --container-bg: #1e1e1e;
            --pool-bg: #2d2d2d;
            --history-border: #444;
            --button-bg: #2ecc71;
            --button-hover: #27ae60;
            --button-clear: #e74c3c;
            --button-clear-hover: #c0392b;
            --dice-bg: #3498db;
            --dice-text: white;
            --tab-inactive: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        h1, h2 {
            text-align: center;
            color: var(--text-color);
        }
        .container {
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }
        .tab-buttons {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            background-color: var(--tab-inactive);
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
            color: var(--text-color);
        }
        .tab-button.active {
            background-color: var(--dice-bg);
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .dice-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }
        .dice-option {
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--dice-bg);
            color: var(--dice-text);
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s, box-shadow 0.2s;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .genesys-dice {
            width: 70px;
            height: 70px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: relative;
            font-size: 12px;
            text-align: center;
            padding: 5px;
        }
        .genesys-dice svg {
            width: 40px;
            height: 40px;
            margin-bottom: 2px;
        }
        .genesys-dice .dice-label {
            font-weight: bold;
            margin-top: 2px;
        }
        .ability-dice { background-color: #3498db; color: white; }
        .proficiency-dice { background-color: #f1c40f; color: black; }
        .difficulty-dice { background-color: #9b59b6; color: white; }
        .challenge-dice { background-color: #e74c3c; color: white; }
        .boost-dice { background-color: #2ecc71; color: white; }
        .setback-dice { background-color: #34495e; color: white; }
        .force-dice { background-color: #e67e22; color: white; }
        
        .dice-option:hover, .genesys-dice:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .dice-option:active, .genesys-dice:active {
            transform: scale(0.95);
        }
        .pool-section {
            margin: 20px 0;
            padding: 15px;
            background-color: var(--pool-bg);
            border-radius: 8px;
            min-height: 80px;
            transition: background-color 0.3s;
        }
        .pool-title {
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--text-color);
        }
        .dice-in-pool {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            margin: 5px;
            font-weight: bold;
            position: relative;
            background-color: var(--dice-bg);
            color: var(--dice-text);
            box-shadow: 0 2px 3px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        
        .dice-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--button-clear);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        .options {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            align-items: center;
        }
        .option-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: var(--button-bg);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: var(--button-hover);
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .clear-btn {
            background-color: var(--button-clear);
        }
        .clear-btn:hover {
            background-color: var(--button-clear-hover);
        }
        .results {
            margin-top: 20px;
        }
        .dice-result {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            margin: 5px;
            font-weight: bold;
            box-shadow: 0 2px 3px rgba(0,0,0,0.2);
            position: relative;
            border-radius: 5px;
            background-color: var(--dice-bg);
            color: var(--dice-text);
        }
        .genesys-result {
            width: 60px;
            height: 60px;
            margin: 5px;
            border-radius: 8px;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            font-size: 10px;
            text-align: center;
        }
        .genesys-result .dice-type {
            font-weight: bold;
            margin-top: 2px;
        }
        .genesys-result svg {
            width: 40px;
            height: 40px;
        }
        .total {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
            color: var(--text-color);
        }
        .history {
            margin-top: 30px;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid var(--history-border);
            transition: border-color 0.3s;
        }
        .rolling {
            animation: shake 0.5s infinite;
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .genesys-symbols {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        .symbol {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
            color: var(--text-color);
        }
        .symbol svg {
            width: 20px;
            height: 20px;
        }
        #theme-toggle-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 12px;
            background-color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ultimate Dice Pool Roller</h1>
        
        <div class="tab-buttons">
            <button class="tab-button active" data-tab="standard">Standard Dice</button>
            <button class="tab-button" data-tab="genesys">Genesys Dice</button>
        </div>
        
        <div id="standard" class="tab-content active">
            <div class="dice-selection">
                <div class="dice-option" data-sides="4">d4</div>
                <div class="dice-option" data-sides="6">d6</div>
                <div class="dice-option" data-sides="8">d8</div>
                <div class="dice-option" data-sides="10">d10</div>
                <div class="dice-option" data-sides="12">d12</div>
                <div class="dice-option" data-sides="20">d20</div>
                <div class="dice-option" data-sides="100">d100</div>
            </div>
            
            <div class="pool-section">
                <div class="pool-title">Your Dice Pool:</div>
                <div id="standard-pool"></div>
            </div>
            
            <div class="options">
                <div class="option-group">
                    <input type="checkbox" id="skip-animation">
                    <label for="skip-animation">Skip rolling animation</label>
                </div>
                <div>
                    <button id="standard-roll-btn" disabled>Roll All Dice</button>
                    <button id="standard-clear-btn" class="clear-btn" disabled>Clear Pool</button>
                </div>
            </div>
            
            <div id="standard-results" class="results" style="display: none;">
                <h3>Roll Results</h3>
                <div id="standard-dice-results"></div>
                <div class="total">Total: <span id="standard-total-result">0</span></div>
            </div>
        </div>
        
        <div id="genesys" class="tab-content">
            <div class="dice-selection">
                <div class="genesys-dice ability-dice" data-type="ability">
                    <svg viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#3498db"/>
                        <text x="50" y="55" text-anchor="middle" fill="white" font-size="40">A</text>
                    </svg>
                    <div class="dice-label">Ability</div>
                </div>
                <div class="genesys-dice proficiency-dice" data-type="proficiency">
                    <svg viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#f1c40f"/>
                        <text x="50" y="55" text-anchor="middle" fill="black" font-size="40">P</text>
                    </svg>
                    <div class="dice-label">Proficiency</div>
                </div>
                <div class="genesys-dice difficulty-dice" data-type="difficulty">
                    <svg viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#9b59b6"/>
                        <text x="50" y="55" text-anchor="middle" fill="white" font-size="40">D</text>
                    </svg>
                    <div class="dice-label">Difficulty</div>
                </div>
                <div class="genesys-dice challenge-dice" data-type="challenge">
                    <svg viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#e74c3c"/>
                        <text x="50" y="55" text-anchor="middle" fill="white" font-size="40">C</text>
                    </svg>
                    <div class="dice-label">Challenge</div>
                </div>
                <div class="genesys-dice boost-dice" data-type="boost">
                    <svg viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#2ecc71"/>
                        <text x="50" y="55" text-anchor="middle" fill="white" font-size="40">B</text>
                    </svg>
                    <div class="dice-label">Boost</div>
                </div>
                <div class="genesys-dice setback-dice" data-type="setback">
                    <svg viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#34495e"/>
                        <text x="50" y="55" text-anchor="middle" fill="white" font-size="40">S</text>
                    </svg>
                    <div class="dice-label">Setback</div>
                </div>
                <div class="genesys-dice force-dice" data-type="force">
                    <svg viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#e67e22"/>
                        <text x="50" y="55" text-anchor="middle" fill="white" font-size="40">F</text>
                    </svg>
                    <div class="dice-label">Force</div>
                </div>
            </div>
            
            <div class="pool-section">
                <div class="pool-title">Your Genesys Dice Pool:</div>
                <div id="genesys-pool"></div>
            </div>
            
            <div class="options">
                <div class="option-group">
                    <input type="checkbox" id="genesys-skip-animation">
                    <label for="genesys-skip-animation">Skip rolling animation</label>
                </div>
                <div>
                    <button id="genesys-roll-btn" disabled>Roll All Dice</button>
                    <button id="genesys-clear-btn" class="clear-btn" disabled>Clear Pool</button>
                </div>
            </div>
            
            <div id="genesys-results" class="results" style="display: none;">
                <h3>Roll Results</h3>
                <div id="genesys-dice-results"></div>
                <div class="genesys-symbols">
                    <div class="symbol"><svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="10" fill="#2ecc71"/></svg> Success</div>
                    <div class="symbol"><svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="10" fill="#e74c3c"/></svg> Failure</div>
                    <div class="symbol"><svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="10" fill="#3498db"/></svg> Advantage</div>
                    <div class="symbol"><svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="10" fill="#9b59b6"/></svg> Threat</div>
                    <div class="symbol"><svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="10" fill="#f1c40f"/></svg> Triumph</div>
                    <div class="symbol"><svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="10" fill="#e74c3c"/></svg> Despair</div>
                    <div class="symbol"><svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="10" fill="#e67e22"/></svg> Light</div>
                    <div class="symbol"><svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="10" fill="#2c3e50"/></svg> Dark</div>
                </div>
                <div class="total">
                    Results: 
                    <span id="genesys-success">0</span> Success, 
                    <span id="genesys-advantage">0</span> Advantage, 
                    <span id="genesys-triumph">0</span> Triumph, 
                    <span id="genesys-despair">0</span> Despair
                </div>
            </div>
        </div>
        
        <div class="history">
            <div class="history-header">
                <h3>Roll History</h3>
                <button id="clear-history-btn" class="clear-btn">Clear History</button>
            </div>
            <div id="history-list"></div>
        </div>
    </div>

    <button id="theme-toggle-btn">ðŸŒ“ Toggle Theme</button>

    <audio id="dice-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-dice-rolling-1941.mp3" type="audio/mpeg">
    </audio>

    <script>
       
        let rollHistory = [];
        
        document.addEventListener('DOMContentLoaded', function() {
         y
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            
            themeToggleBtn.addEventListener('click', function() {
                document.body.classList.toggle('dark-theme');
            
                localStorage.setItem('darkTheme', document.body.classList.contains('dark-theme'));
            });
            
          
            if (localStorage.getItem('darkTheme') === 'true') {
                document.body.classList.add('dark-theme');
            }

          
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
         
            const standardDiceOptions = document.querySelectorAll('#standard .dice-option');
            const standardDicePool = document.getElementById('standard-pool');
            const standardRollBtn = document.getElementById('standard-roll-btn');
            const standardClearBtn = document.getElementById('standard-clear-btn');
            const standardResultsDiv = document.getElementById('standard-results');
            const standardDiceResultsDiv = document.getElementById('standard-dice-results');
            const standardTotalResultSpan = document.getElementById('standard-total-result');
            const skipAnimationCheckbox = document.getElementById('skip-animation');
            const historyList = document.getElementById('history-list');
            
            let standardPool = [];
            
            standardDiceOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    if (e.button !== 0) return;
                    const sides = parseInt(this.getAttribute('data-sides'));
                    standardPool.push(sides);
                    updateStandardPoolDisplay();
                    updateStandardButtons();
                });
                
                option.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    const sides = parseInt(this.getAttribute('data-sides'));
                    const index = standardPool.lastIndexOf(sides);
                    if (index !== -1) {
                        standardPool.splice(index, 1);
                        updateStandardPoolDisplay();
                        updateStandardButtons();
                    }
                });
            });
            
            standardRollBtn.addEventListener('click', async function() {
                if (standardPool.length === 0) return;
                
               
                document.getElementById('dice-sound').currentTime = 0;
                document.getElementById('dice-sound').play();
                
              
                if (!skipAnimationCheckbox.checked) {
                    standardRollBtn.disabled = true;
                    standardRollBtn.classList.add('rolling');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    standardRollBtn.classList.remove('rolling');
                }
                
                
                const results = [];
                let total = 0;
                
                standardPool.forEach(sides => {
                    const roll = Math.floor(Math.random() * sides) + 1;
                    results.push({ sides, value: roll });
                    total += roll;
                });
                
                
                standardDiceResultsDiv.innerHTML = '';
                results.forEach(result => {
                    const dieElement = document.createElement('div');
                    dieElement.className = 'dice-result';
                    dieElement.textContent = result.value;
                    dieElement.title = `d${result.sides}: ${result.value}`;
                    standardDiceResultsDiv.appendChild(dieElement);
                });
                
                standardTotalResultSpan.textContent = total;
                standardResultsDiv.style.display = 'block';
                
               
                addToHistory('standard', standardPool, results, total);
                
                standardRollBtn.disabled = standardPool.length === 0;
            });
            
            standardClearBtn.addEventListener('click', function() {
                standardPool = [];
                updateStandardPoolDisplay();
                updateStandardButtons();
                standardResultsDiv.style.display = 'none';
            });
            
            function updateStandardPoolDisplay() {
                standardDicePool.innerHTML = '';
                
                const diceCount = {};
                standardPool.forEach(sides => {
                    diceCount[sides] = (diceCount[sides] || 0) + 1;
                });
                
                Object.entries(diceCount).forEach(([sides, count]) => {
                    const dieElement = document.createElement('div');
                    dieElement.className = 'dice-in-pool';
                    dieElement.setAttribute('data-sides', sides);
                    dieElement.textContent = `d${sides}`;
                    dieElement.title = `${count}d${sides}`;
                    
                    
                    if (count > 1) {
                        const countBadge = document.createElement('div');
                        countBadge.className = 'dice-count';
                        countBadge.textContent = count;
                        dieElement.appendChild(countBadge);
                    }
                    
                    standardDicePool.appendChild(dieElement);
                });
            }
            
            function updateStandardButtons() {
                standardRollBtn.disabled = standardPool.length === 0;
                standardClearBtn.disabled = standardPool.length === 0;
            }
            
           
            const genesysDiceOptions = document.querySelectorAll('#genesys .genesys-dice');
            const genesysDicePool = document.getElementById('genesys-pool');
            const genesysRollBtn = document.getElementById('genesys-roll-btn');
            const genesysClearBtn = document.getElementById('genesys-clear-btn');
            const genesysResultsDiv = document.getElementById('genesys-results');
            const genesysDiceResultsDiv = document.getElementById('genesys-dice-results');
            const genesysSkipAnimationCheckbox = document.getElementById('genesys-skip-animation');
            
           
            const genesysSuccessSpan = document.getElementById('genesys-success');
            const genesysAdvantageSpan = document.getElementById('genesys-advantage');
            const genesysTriumphSpan = document.getElementById('genesys-triumph');
            const genesysDespairSpan = document.getElementById('genesys-despair');
            
            let genesysPool = [];
            
           
            const genesysDiceProbabilities = {
                ability: [
                    { success: 0, advantage: 0 }, // Blank
                    { success: 1, advantage: 0 }, // 1 success
                    { success: 1, advantage: 1 }, // 1 success, 1 advantage
                    { success: 2, advantage: 0 }, // 2 success
                    { success: 0, advantage: 2 }, // 2 advantage
                    { success: 0, advantage: 1 }  // 1 advantage
                ],
                proficiency: [
                    { success: 0, advantage: 0 }, // Blank
                    { success: 1, advantage: 0 }, // 1 success
                    { success: 1, advantage: 1 }, // 1 success, 1 advantage
                    { success: 2, advantage: 0 }, // 2 success
                    { success: 0, advantage: 2 }, // 2 advantage
                    { success: 1, advantage: 0, triumph: 1 } // 1 success, 1 triumph
                ],
                difficulty: [
                    { failure: 0, threat: 0 }, // Blank
                    { failure: 1, threat: 0 }, // 1 failure
                    { failure: 2, threat: 0 }, // 2 failure
                    { failure: 0, threat: 1 }, // 1 threat
                    { failure: 0, threat: 2 }, // 2 threat
                    { failure: 1, threat: 1 }  // 1 failure, 1 threat
                ],
                challenge: [
                    { failure: 0, threat: 0 }, // Blank
                    { failure: 1, threat: 0 }, // 1 failure
                    { failure: 1, threat: 1 }, // 1 failure, 1 threat
                    { failure: 2, threat: 0 }, // 2 failure
                    { failure: 0, threat: 2 }, // 2 threat
                    { failure: 0, threat: 0, despair: 1 } // 1 despair
                ],
                boost: [
                    { success: 0, advantage: 0 }, // Blank
                    { success: 1, advantage: 0 }, // 1 success
                    { success: 1, advantage: 1 }, // 1 success, 1 advantage
                    { success: 0, advantage: 2 }, // 2 advantage
                    { success: 0, advantage: 1 }, // 1 advantage
                    { success: 0, advantage: 0 }  // Blank
                ],
                setback: [
                    { failure: 0, threat: 0 }, // Blank
                    { failure: 1, threat: 0 }, // 1 failure
                    { failure: 1, threat: 0 }, // 1 failure
                    { failure: 0, threat: 1 }, // 1 threat
                    { failure: 0, threat: 1 }, // 1 threat
                    { failure: 0, threat: 0 }  // Blank
                ],
                force: [
                    { light: 0, dark: 0 }, // Blank
                    { light: 1, dark: 0 }, // 1 light
                    { light: 1, dark: 0 }, // 1 light
                    { light: 2, dark: 0 }, // 2 light
                    { light: 0, dark: 1 }, // 1 dark
                    { light: 0, dark: 1 }, // 1 dark
                    { light: 0, dark: 2 }, // 2 dark
                    { light: 0, dark: 0 }  // Blank
                ]
            };
            
            genesysDiceOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    if (e.button !== 0) return;
                    const type = this.getAttribute('data-type');
                    genesysPool.push(type);
                    updateGenesysPoolDisplay();
                    updateGenesysButtons();
                });
                
                option.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    const type = this.getAttribute('data-type');
                    const index = genesysPool.lastIndexOf(type);
                    if (index !== -1) {
                        genesysPool.splice(index, 1);
                        updateGenesysPoolDisplay();
                        updateGenesysButtons();
                    }
                });
            });
            
            genesysRollBtn.addEventListener('click', async function() {
                if (genesysPool.length === 0) return;
                
               
                document.getElementById('dice-sound').currentTime = 0;
                document.getElementById('dice-sound').play();
                
              
                if (!genesysSkipAnimationCheckbox.checked) {
                    genesysRollBtn.disabled = true;
                    genesysRollBtn.classList.add('rolling');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    genesysRollBtn.classList.remove('rolling');
                }
                
                
                const results = [];
                let success = 0, advantage = 0, triumph = 0;
                let failure = 0, threat = 0, despair = 0;
                let light = 0, dark = 0;
                
                genesysPool.forEach(type => {
                    const sides = genesysDiceProbabilities[type].length;
                    const rollIndex = Math.floor(Math.random() * sides);
                    const result = genesysDiceProbabilities[type][rollIndex];
                    
                    results.push({ type, result });
                    
                   
                    success += result.success || 0;
                    advantage += result.advantage || 0;
                    triumph += result.triumph || 0;
                    failure += result.failure || 0;
                    threat += result.threat || 0;
                    despair += result.despair || 0;
                    light += result.light || 0;
                    dark += result.dark || 0;
                });
                
                
                const netSuccess = Math.max(0, success - failure);
                const netAdvantage = Math.max(0, advantage - threat);
                
            
                genesysDiceResultsDiv.innerHTML = '';
                results.forEach((result, index) => {
                    const dieElement = document.createElement('div');
                    dieElement.className = `genesys-result ${result.type}-dice`;
                    
                  
                    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svg.setAttribute('viewBox', '0 0 100 100');
                    
                   
                    const bg = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    bg.setAttribute('cx', '50');
                    bg.setAttribute('cy', '50');
                    bg.setAttribute('r', '45');
                    
                 
                    switch(result.type) {
                        case 'ability': bg.setAttribute('fill', '#3498db'); break;
                        case 'proficiency': bg.setAttribute('fill', '#f1c40f'); break;
                        case 'difficulty': bg.setAttribute('fill', '#9b59b6'); break;
                        case 'challenge': bg.setAttribute('fill', '#e74c3c'); break;
                        case 'boost': bg.setAttribute('fill', '#2ecc71'); break;
                        case 'setback': bg.setAttribute('fill', '#34495e'); break;
                        case 'force': bg.setAttribute('fill', '#e67e22'); break;
                    }
                    
                    svg.appendChild(bg);
                    
                  
                    if (result.result.success > 0) {
                        const successSymbol = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        successSymbol.setAttribute('cx', '30');
                        successSymbol.setAttribute('cy', '30');
                        successSymbol.setAttribute('r', '10');
                        successSymbol.setAttribute('fill', '#2ecc71');
                        svg.appendChild(successSymbol);
                    }
                    if (result.result.failure > 0) {
                        const failureSymbol = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        failureSymbol.setAttribute('cx', '70');
                        failureSymbol.setAttribute('cy', '30');
                        failureSymbol.setAttribute('r', '10');
                        failureSymbol.setAttribute('fill', '#e74c3c');
                        svg.appendChild(failureSymbol);
                    }
                    if (result.result.advantage > 0) {
                        const advantageSymbol = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        advantageSymbol.setAttribute('cx', '30');
                        advantageSymbol.setAttribute('cy', '70');
                        advantageSymbol.setAttribute('r', '10');
                        advantageSymbol.setAttribute('fill', '#3498db');
                        svg.appendChild(advantageSymbol);
                    }
                    if (result.result.threat > 0) {
                        const threatSymbol = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        threatSymbol.setAttribute('cx', '70');
                        threatSymbol.setAttribute('cy', '70');
                        threatSymbol.setAttribute('r', '10');
                        threatSymbol.setAttribute('fill', '#9b59b6');
                        svg.appendChild(threatSymbol);
                    }
                    if (result.result.triumph > 0) {
                        const triumphSymbol = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        triumphSymbol.setAttribute('cx', '50');
                        triumphSymbol.setAttribute('cy', '20');
                        triumphSymbol.setAttribute('r', '10');
                        triumphSymbol.setAttribute('fill', '#f1c40f');
                        svg.appendChild(triumphSymbol);
                    }
                    if (result.result.despair > 0) {
                        const despairSymbol = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        despairSymbol.setAttribute('cx', '50');
                        despairSymbol.setAttribute('cy', '80');
                        despairSymbol.setAttribute('r', '10');
                        despairSymbol.setAttribute('fill', '#e74c3c');
                        svg.appendChild(despairSymbol);
                    }
                    if (result.result.light > 0) {
                        const lightSymbol = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        lightSymbol.setAttribute('cx', '30');
                        lightSymbol.setAttribute('cy', '50');
                        lightSymbol.setAttribute('r', '10');
                        lightSymbol.setAttribute('fill', '#e67e22');
                        svg.appendChild(lightSymbol);
                    }
                    if (result.result.dark > 0) {
                        const darkSymbol = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        darkSymbol.setAttribute('cx', '70');
                        darkSymbol.setAttribute('cy', '50');
                        darkSymbol.setAttribute('r', '10');
                        darkSymbol.setAttribute('fill', '#2c3e50');
                        svg.appendChild(darkSymbol);
                    }
                    
                    dieElement.appendChild(svg);
                    
                   
                    const typeLabel = document.createElement('div');
                    typeLabel.className = 'dice-type';
                    typeLabel.textContent = getGenesysDiceName(result.type);
                    dieElement.appendChild(typeLabel);
                    
                   
                    let tooltip = `${getGenesysDiceName(result.type)}: `;
                    const resultParts = [];
                    
                    if (result.result.success) resultParts.push(`${result.result.success} Success`);
                    if (result.result.advantage) resultParts.push(`${result.result.advantage} Advantage`);
                    if (result.result.failure) resultParts.push(`${result.result.failure} Failure`);
                    if (result.result.threat) resultParts.push(`${result.result.threat} Threat`);
                    if (result.result.triumph) resultParts.push('Triumph');
                    if (result.result.despair) resultParts.push('Despair');
                    if (result.result.light) resultParts.push(`${result.result.light} Light`);
                    if (result.result.dark) resultParts.push(`${result.result.dark} Dark`);
                    
                    if (resultParts.length === 0) {
                        tooltip += "Blank";
                    } else {
                        tooltip += resultParts.join(", ");
                    }
                    
                    dieElement.title = tooltip;
                    genesysDiceResultsDiv.appendChild(dieElement);
                });
                
               
                genesysSuccessSpan.textContent = netSuccess;
                genesysAdvantageSpan.textContent = netAdvantage;
                genesysTriumphSpan.textContent = triumph;
                genesysDespairSpan.textContent = despair;
                genesysResultsDiv.style.display = 'block';
                
                addToHistory('genesys', genesysPool, results, {
                    success: netSuccess,
                    advantage: netAdvantage,
                    triumph,
                    despair
                });
                
                genesysRollBtn.disabled = genesysPool.length === 0;
            });
            
            genesysClearBtn.addEventListener('click', function() {
                genesysPool = [];
                updateGenesysPoolDisplay();
                updateGenesysButtons();
                genesysResultsDiv.style.display = 'none';
            });
            
            function updateGenesysPoolDisplay() {
                genesysDicePool.innerHTML = '';
                
                const diceCount = {};
                genesysPool.forEach(type => {
                    diceCount[type] = (diceCount[type] || 0) + 1;
                });
                
                Object.entries(diceCount).forEach(([type, count]) => {
                    const dieElement = document.createElement('div');
                    dieElement.className = `dice-in-pool`;
                    dieElement.setAttribute('data-dicetype', type);
                    
                   
                    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svg.setAttribute('viewBox', '0 0 100 100');
                    
                  
                    const bg = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    bg.setAttribute('cx', '50');
                    bg.setAttribute('cy', '50');
                    bg.setAttribute('r', '45');
                    
               
                    switch(type) {
                        case 'ability': bg.setAttribute('fill', '#3498db'); break;
                        case 'proficiency': bg.setAttribute('fill', '#f1c40f'); break;
                        case 'difficulty': bg.setAttribute('fill', '#9b59b6'); break;
                        case 'challenge': bg.setAttribute('fill', '#e74c3c'); break;
                        case 'boost': bg.setAttribute('fill', '#2ecc71'); break;
                        case 'setback': bg.setAttribute('fill', '#34495e'); break;
                        case 'force': bg.setAttribute('fill', '#e67e22'); break;
                    }
                    
                    svg.appendChild(bg);
                    
                  
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', '50');
                    text.setAttribute('y', '55');
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('fill', type === 'proficiency' ? 'black' : 'white');
                    text.setAttribute('font-size', '40');
                    text.textContent = type.charAt(0).toUpperCase();
                    svg.appendChild(text);
                    
                    dieElement.appendChild(svg);
                    
                  
                    const typeLabel = document.createElement('div');
                    typeLabel.style.fontSize = '10px';
                    typeLabel.style.fontWeight = 'bold';
                    typeLabel.style.marginTop = '2px';
                    typeLabel.textContent = getGenesysDiceName(type).charAt(0);
                    dieElement.appendChild(typeLabel);
                    
                    
                    if (count > 1) {
                        const countBadge = document.createElement('div');
                        countBadge.className = 'dice-count';
                        countBadge.textContent = count;
                        dieElement.appendChild(countBadge);
                    }
                    
                
                    dieElement.title = `${count} ${getGenesysDiceName(type)} ${count > 1 ? 'Dice' : 'Die'}`;
                    
                    genesysDicePool.appendChild(dieElement);
                });
            }
            
            function updateGenesysButtons() {
                genesysRollBtn.disabled = genesysPool.length === 0;
                genesysClearBtn.disabled = genesysPool.length === 0;
            }
            
         
            function getGenesysDiceName(type) {
                const names = {
                    'ability': 'Ability',
                    'proficiency': 'Proficiency',
                    'difficulty': 'Difficulty',
                    'challenge': 'Challenge',
                    'boost': 'Boost',
                    'setback': 'Setback',
                    'force': 'Force'
                };
                return names[type] || type;
            }
            
          
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            
            clearHistoryBtn.addEventListener('click', function() {
                rollHistory = [];
                historyList.innerHTML = '';
            });
            
            function addToHistory(type, pool, results, total) {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                if (type === 'standard') {
                    // Standard dice history
                    const diceCount = {};
                    pool.forEach(sides => {
                        diceCount[sides] = (diceCount[sides] || 0) + 1;
                    });
                    
                    let notation = '';
                    Object.entries(diceCount).forEach(([sides, count]) => {
                        notation += `${notation ? ' + ' : ''}${count}d${sides}`;
                    });
                    
                    const resultValues = results.map(r => r.value);
                    historyItem.textContent = `${notation} â†’ [${resultValues.join(', ')}] = ${total}`;
                } else {
                    // Genesys dice history
                    const diceCount = {};
                    pool.forEach(dieType => {
                        diceCount[dieType] = (diceCount[dieType] || 0) + 1;
                    });
                    
                    let notation = '';
                    Object.entries(diceCount).forEach(([dieType, count]) => {
                        notation += `${notation ? ' + ' : ''}${count}${getGenesysDiceName(dieType).charAt(0)}`;
                    });
                    
                    let resultText = '';
                    if (total.success > 0) resultText += `${total.success} Success `;
                    if (total.advantage > 0) resultText += `${total.advantage} Advantage `;
                    if (total.triumph > 0) resultText += `${total.triumph} Triumph `;
                    if (total.despair > 0) resultText += `${total.despair} Despair`;
                    
                    historyItem.textContent = `${notation} â†’ ${resultText.trim()}`;
                }
                
                
                rollHistory.unshift(historyItem.textContent);
                if (rollHistory.length > 20) {
                    rollHistory.pop();
                }
                
              
                historyList.innerHTML = '';
                rollHistory.forEach(item => {
                    const historyEntry = document.createElement('div');
                    historyEntry.className = 'history-item';
                    historyEntry.textContent = item;
                    historyList.appendChild(historyEntry);
                });
            }
            
            
            standardDicePool.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
            genesysDicePool.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
        });
    </script>
</body>
</html>
